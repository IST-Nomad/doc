
Заявка по секретам 1632982


Чтобы убрать пароли из строки подключения необходимо
1) создать техническую учетную запись , под которой будет запускаться сервер приложений 
2) дать необходимые доступы в MSSQL сервер для данного пользователя 
3) в настройках службы прописать технического пользователя 
4) поменять connection string , пример:
  <ConnectionString value="server=sql2019; database=GestBank; integrated security=SSPI;  persist security info=True; packet size=4096; connection lifetime=500; min pool size=1; max pool size=50" />





в продолжении темы Хранение пароля в открытом виде_Финист
еще один вариант:
Краткая инструкция
1) Добавить секреты в файл appsettings.json. Секрет записывается в открытом виде, в секции GEstSecrets, указывается имя секрета и его значение.

"GEstSecrets": {
    "some_secret": "some_secret_value",
    "db_password": "password_as_is"
}
2) Выполнить шифрование секции GEstSecrets в файле appsettings.json. Для этого выполняем в командной строке команду вида:

GEstBank.Server.Service60.exe gest-secrets-enc
После выполнения команды секция GEstSecrets будет иметь подобный вид:

"GEstSecrets": {
    "some_secret": "enc:DSIwDFC8oPPSDSDiosa=",
    "db_password": "enc:ERFN7cFJnSD=="
}
3) В конфигурационном файле (*.dll.config) в требуемых местах указать применение секрета (связка префикс "@gest-secret:" и имя секрета):

<item name="somename" password="@gest-secret:some_secret" />
<ConnectionString value="server=localhost; database=ProjectDB;" password="@gest-secret:db_password"/>





C:\Windows\system32>"C:\Finist_day\GEstBank\Server\GEstBank.Server.Service60.exe" gest-secrets-enc
Unhandled exception. System.IO.FileNotFoundException: Could not find file 'C:\Windows\system32\appsettings.json'.
File name: 'C:\Windows\system32\appsettings.json'
   at Microsoft.Win32.SafeHandles.SafeFileHandle.CreateFile(String fullPath, FileMode mode, FileAccess access, FileShare share, FileOptions options)
   at Microsoft.Win32.SafeHandles.SafeFileHandle.Open(String fullPath, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize)
   at System.IO.Strategies.OSFileStreamStrategy..ctor(String path, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize)
   at GEst.Common.GEstSecrets.EncryptFile(String jsonFileName)
   at GEst.Hosting.GEstProgram.StandardRunWebHost[TGEstStarterService,TGEstWebStartup](GEstHostContext gestHostContext, Action`1 webHostConfigurator)
   at GEstBank.Server.Service60.Program.Main(String[] args)




"GEstSecrets": {
    "db_pass": "enc:pn0EVZ4="
  }


<ConnectionString value="server=FINIST-PRE; database=GEstBank_Krona_day; integrated security=false; user=finistuser; password="@gest-secret:db_pass"; persist security info=True; packet size=4096; connection lifetime=500; min pool size=1; max pool size=50" />


"GEstSecrets": {
    "db_pass": "enc:pn0EVZ4="
  }




1 шаг 
appsettings.json 
  "GEstSecrets": {
    "db_pass": "server=FINIST-PRE; database=GEstBank_Krona_day; integrated security=false; user=finistuser; password=curr; persist security info=True; packet size=4096; connection lifetime=500; min pool size=1; max pool size=50"
  }
2 шаг 
перейти в директорию 
cd C:\Finist_day\GEstBank\Server
запустить шифрование
GEstBank.Server.Service60.exe gest-secrets-enc
3 шаг
GEstBank.Server.Service60.dll.config
<ConnectionString value="@gest-secret:db_pass" /> 
