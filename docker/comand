Работа с Docker и контейнерами

Введение
Docker – это инструмент контейнеризации, который позволяет упрощать развертывание и управление приложениями. В этом руководстве мы рассмотрим основные команды и концепции, необходимые для работы с контейнерами.



1. Установка Docker
На Linux (Ubuntu/Debian):

sudo apt update && sudo apt install -y docker.io
sudo systemctl enable --now docker

На CentOS/RHEL:

sudo yum install -y docker
sudo systemctl enable --now docker

Проверка установки:

docker --version

2. Основные команды Docker

2.1 Запуск контейнера (docker run)
Запустить контейнер можно с помощью команды:

docker run -d --name my_container nginx

Параметры:
- -d – фоновый режим
- --name – задание имени контейнеру
- nginx – имя образа

2.2 Список работающих контейнеров

docker ps

Для отображения всех контейнеров (включая остановленные):

docker ps -a

2.3 Остановка и удаление контейнеров
Остановка контейнера:

docker stop my_container

Удаление контейнера:

docker rm my_container

2.4 Запуск команд в работающем контейнере
Выполнить команду в контейнере:

docker exec -it my_container bash

3. Работа с Docker Compose
Docker Compose позволяет управлять несколькими контейнерами с помощью YAML-файла.

3.1 Установка Docker Compose

sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

3.2 Пример docker-compose.yml
Создадим файл docker-compose.yml:

version: '3'
services:
  web:
    image: nginx
    ports:
      - "80:80"
  db:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpass

3.3 Запуск и управление сервисами
Запустить контейнеры:

docker-compose up -d

Остановить контейнеры:

docker-compose down

Просмотреть логи:

docker-compose logs -f

4. Работа с образами (Docker Images)

4.1 Список локальных образов

docker images

4.2 Поиск образов

docker search ubuntu

4.3 Загрузка образа

docker pull ubuntu

4.4 Создание своего образа
Создайте Dockerfile:

FROM ubuntu:latest
RUN apt update && apt install -y nginx
CMD ["nginx", "-g", "daemon off;"]

Соберите образ:

docker build -t my_nginx .

5. Работа с томами (Volumes)
Тома используются для хранения данных контейнеров.

5.1 Создание и просмотр томов
Создать новый том:

docker volume create my_volume

Просмотреть список томов:

docker volume ls

5.2 Подключение тома к контейнеру

docker run -d -v my_volume:/data --name my_container nginx


#Проверьте список запущенных контейнеров
docker ps --format "table {{.ID}}\t{{.Names}}\t{{.Status}}"

#Выполните полный перезапуск стека:
docker compose down -v 
docker system prune -a
docker compose up -d



docker exec -it wazuh-stack-wazuh.indexer-1 bash -c "
echo 'plugins.security.disabled: true' >> /usr/share/wazuh-indexer/config/opensearch.yml
echo 'opensearch_security.disabled: true' >> /usr/share/wazuh-indexer/config/opensearch.yml
"

#Первым делом посмотрим логи
docker logs 82c6dc859d6b --tail 100 -f

docker compose logs -f wazuh.indexer --tail 100



